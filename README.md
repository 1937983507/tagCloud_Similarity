# 地名标签云（fabricTagCloud） V4.0

本项目作为一个面向地理信息可视化与空间数据分析的专业级可视化系统，将**多角度径向移位算法**和中心型标签云布局紧密耦合，为研究者和数据分析师提供"地图展示 → 数据筛选 → 标签云生成 → 样式定制"的一站式工作台。项目基于 **Fabric.js + Vue 3 + Pinia** 构建，采用**多角度径向移位算法**实现全局无压盖的标签云绘制，并支持多尺度渲染、实时参数联动、语言切换等高级功能，可应用于旅游景点分析、区域热点识别、地理教学演示、空间数据探索等场景。

---

## 🌐 项目在线访问

本项目已部署在线网站，用户可以直接通过浏览器访问体验完整功能：

🔗 [访问在线网站](https://www.hubutagcloud.cn/)

无需本地下载或安装，即可进行地名标签云的生成、样式调整、数据管理和多尺度展示。

---

## ✨ 特性总览

- **一体化交互流程**：顶部导航、侧边样式面板、地图工作区与标签云画布组成协同布局，辅以 Intro.js 引导降低首次上手成本。
- **高德地图深度整合**：支持地图缩放、拖拽、搜索定位、热力/点状图层切换、多底图切换；可在地图上绘制圆形/矩形/多边形区域进行数据筛选。
- **数据管线自动化**：基于绘制区域自动筛选 POI 数据，支持数据编辑、筛选、批量操作，实时同步到标签云画布。
- **多角度径向移位算法**：基于 Fabric.js 相关接口，创新性地构建文本标签的多角度径向移位算法，包括自适应范围扫描、最优步长偏移等步骤，实现全局无压盖的标签云绘制。
- **多尺度标签云渲染**：构建多尺度模型，支持粗略显示和精细显示两种模式，实现全局与局部效应的兼顾观测。
- **可视化可编排**：字体（含中文/英文切换、字体类别、字号、字重、字体类型）、配色（背景色、色带配置、配色数量、渲染方式）均以卡片式面板配置，实时写入 Pinia Store 并驱动画布更新。
- **高级交互功能**：支持动态排名与时间显示、标签高亮、详情查看、画布操作（返回中心、缩放、漫游）等交互功能。
- **导出与分享**：支持标签云画布的交互操作，适合在汇报、论文和 Demo 中展示（当前版本基于 Fabric.js Canvas，支持画布交互）。

---

## 🛠 技术栈

- **构建工具**：Vite 5 + ESBuild（原生 ESM，秒级冷启动）
- **框架**：Vue 3 `<script setup>` + Pinia（状态管理）
- **UI / 交互**：Element Plus、Intro.js、Sass
- **数据 & 可视化**：Fabric.js Canvas、自研 **多角度径向移位算法**、多尺度渲染模型
- **地图能力**：高德地图 JSAPI 2.0（AMapLoader，含 ToolBar/HeatMap/MassMarks/Driving 等插件）
- **其他工具**：
  - Axios（HTTP 请求）
  - Marked（Markdown 解析）
  - Lodash-es（工具函数）

依赖与脚本定义见 `package.json`。

---

## 📂 项目结构

```text
fabricTagCloud4/
├── public/
│   ├── data/               # 数据文件（china.json 等）
│   └── img/                # 图片资源
├── src/
│   ├── assets/styles/      # 全局样式 (SCSS)
│   ├── components/
│   │   ├── color/         # ColorPanel：配色面板（背景色、色带配置）
│   │   ├── common/         # SplitterBar：分割条组件
│   │   ├── content/        # PoiMap、PoiTable、PoiContent：地图、数据表、内容容器
│   │   ├── feedback/       # FeedbackPage：反馈页面
│   │   ├── help/          # HelpPage：帮助页面（基于 Markdown 渲染）
│   │   ├── layout/        # HeaderBar、FooterBar、SideMenu：布局组件
│   │   ├── tagcloud/      # TagCloudCanvas：标签云画布（多角度径向移位算法、多尺度渲染）
│   │   └── typeface/      # TypefacePanel：字体面板（语言、字号、字重、字体类型）
│   ├── stores/poiStore.js  # Pinia 数据中心（POI 数据、字体/配色配置、标签云状态等）
│   ├── App.vue / main.js   # 根组件与入口
│   └── ...
├── doc/                    # 文档目录（PDF 文档、示例数据）
├── vite.config.js
└── README.md
```

---

## 🚀 快速开始

1. **准备环境**
   - Node.js ≥ 18（Vite 官方推荐版本）
   - 配置高德 JSAPI 的 Referer 白名单，必要时替换 `PoiMap.vue` 中的 `key`

2. **安装依赖**

   ```bash
   npm install
   ```

3. **本地开发**

   ```bash
   npm run dev
   ```

   - 默认启动在 `http://localhost:5173`
   - 支持 Vite HMR，适合快速迭代前端面板

4. **生产构建 / 预览**

   ```bash
   npm run build
   npm run preview
   ```

5. **环境变量配置（可选）**

   如果需要自定义统计服务后端地址，创建 `.env` 文件：

   ```bash
   # 开发环境：使用 localhost
   VITE_STATS_API_URL=http://localhost:3001
   
   # 生产环境：留空使用相对路径（通过 Nginx 代理）
   # 或者设置为完整的后端地址
   VITE_STATS_API_URL=
   ```

   生产环境推荐使用相对路径 `/stats-api`，通过 Nginx 代理到后端服务。

---

## 🔧 核心模块说明

| 模块 | 功能摘要 |
| --- | --- |
| `src/App.vue` | 负责整体布局、侧边多面板切换、底部页脚导航，并在首次加载时触发 Intro.js 向导。 |
| `src/components/content/PoiMap.vue` | 封装地图初始化、绘制模式（圆形/矩形/多边形）、热力/点图层切换、地点搜索以及 POI 数据筛选。 |
| `src/stores/poiStore.js` | 统一加载/缓存 POI 数据、记录绘制结果、字体配色参数、标签云状态等信息，实现多组件共享。 |
| `src/components/layout/SideMenu.vue` 等 | 将字体、配色等视觉参数封装为卡片式选择器，实时写入 `poiStore`。 |
| `src/components/tagcloud/TagCloudCanvas.vue` | 调用 Fabric.js 实现多角度径向移位算法生成标签云，并提供多尺度渲染、画布交互、排名时间显示等高级功能。 |

---

## 📊 数据与地图资源

- `public/data/chinapoi.json`：地图数据源（GeoJSON 格式）。
- `public/img/*.png`：示例缩略图、功能演示图、品牌标识。
- **地图 Key**：默认使用演示 Key，请根据部署环境在 `PoiMap.vue` 中替换。

---

## 🖼 效果展示

- **首页**
  ![首页](./public/img/首页.png)

- **渲染标签云**
  ![渲染标签云](./public/img/渲染标签云.png)

- **切换中文字体**：
  ![切换中文字体](./public/img/切换中文字体.png)

- **切换英文**：
  ![切换英文](./public/img/切换英文.png)

- **切换背景色与配色**：
  ![切换背景色与配色](./public/img/切换背景色与配色.png)

- **多尺度渲染**：
  ![精细显示](./public/img/精细显示.png)

- **显示排名与通行时间**：
  ![显示排名与通行时间](./public/img/显示排名与通行时间.png)

---

## 🧭 系统工作流

1. **地图展示与数据查看**：在地图上查看 POI 数据，支持热力图和点状图层切换，通过搜索定位到目标区域。
2. **数据区域选择**：在地图上绘制圆形/矩形/多边形区域，系统自动筛选区域内的 POI 数据。
3. **数据管理**：在数据管理模块中查看、编辑、筛选 POI 数据，支持批量操作和视图切换。
4. **生成标签云**：点击"运行生成标签云"触发 Fabric.js 渲染，采用多角度径向移位算法生成无压盖的标签云。
5. **样式定制**：在侧边面板依次调整字体（语言、类别、字号、字重、字体类型）、配色（背景色、色带、配色数量、渲染方式），与标签云画布实时联动。
6. **多尺度展示**：通过"粗略显示"和"精细显示"切换标签数量，实现多尺度地名标签云渲染展示。
7. **交互探索**：使用排名显示、通行时间显示、标签高亮、详情查看等功能深入探索数据。

---

## 🧪 调试与测试建议

- 使用浏览器 DevTools 观察 `Pinia` Store 中的 `poiData`、`filteredPoiData`、`fontConfig`、`colorConfig`，确认数据筛选和配置结果。
- 建议在真实业务数据上线前，替换新的数据源，并在 `poiStore` 中增加字段映射。
- 使用 Vite 的 HMR 功能快速迭代样式面板和标签云渲染逻辑。

---

## 🔄 版本更新说明

### V4.0 主要变化

相比 V3.0 版本，V4.0 进行了全面的技术栈升级：

1. **框架升级**：从纯 JavaScript 重构为 Vue 3 + Composition API
2. **构建工具**：使用 Vite 替代传统构建方式，提升开发体验
3. **UI 组件**：集成 Element Plus，提供更现代化的界面
4. **状态管理**：使用 Pinia 统一管理应用状态
5. **代码组织**：采用组件化开发，提高代码可维护性和复用性
6. **开发体验**：支持热更新、更好的开发工具支持

### 功能兼容性

V4.0 保持了 V3.0 的所有核心功能，同时提供了更好的用户体验和代码维护性。

### 未来规划

- **功能扩展**：
  - 配置的 JSON 导入/导出功能
  - 更多标签云布局算法
  - 数据源扩展（支持更多 POI 数据格式）
  - 批量处理功能
  - 标签云导出功能（PNG、SVG 等格式）

- **性能优化**：
  - Web Workers 支持，提升大规模数据处理性能
  - 虚拟渲染优化，支持超大规模标签云渲染
  - 算法优化，提升标签云生成速度

- **用户体验**：
  - 更多预设配色方案
  - 模板系统，快速应用常用配置
  - 交互式教程和帮助系统
  - 多语言支持

---

## 👥 团队介绍

我们是 **湖北大学制图组**，由资环学院的 **成晓强导师** 领导。团队研究方向涵盖两个核心领域：

1. **专业热点方向：时空大数据可视化**

   - 利用大数据技术与可视化方法，将地理信息、兴趣点数据与空间分析结果以直观方式呈现。
   - 通过交互式可视化工具（如地名标签云）辅助科研分析、教学演示和数据探索。

2. **专业新兴方向：泛地图学理论与方法**

   - 探索新型地图可视化方法，包括**隐喻地图**和**创新可视化技术**。
   - 致力于将传统地理制图与现代计算可视化结合，推动地图学理论与方法的创新发展。

团队成员来自 **地理学、资源与环境、计算机科学与技术** 等相关专业，我们欢迎本科生、研究生及相关科研人员加入，参与前沿研究、项目开发和学术交流。

实验室官网详细介绍请参阅：
🔗 [湖北大学制图组官网](https://www.hubutagcloud.cn/cxq-group/)

---

## 💬 用户参与与建议

我们非常欢迎广大用户参与 **fabricTagCloud** 的优化与发展，您的建议与反馈对我们至关重要。

您可以通过以下渠道与我们交流：

- **网站反馈模块**：在网站内填写反馈表单，提交功能或体验建议。
- **电子邮件联系**：向团队邮箱 1937983507@qq.com 发送意见或改进建议。
- **GitHub 提问**：在本项目 GitHub 仓库提交 issue，与团队直接交流和讨论。

我们期待您的宝贵意见，并将持续改进，让 fabricTagCloud 更加高效、直观、易用。

---

## 📜 许可

本项目仅供学习与课题组内部使用，禁止未经授权的商用。
